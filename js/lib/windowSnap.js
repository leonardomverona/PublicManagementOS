(function(){
    const SNAP_THRESHOLD = 40; const SNAP_ANIM = 'all 0.18s cubic-bezier(.34,1.56,.64,1)';
    let draggingWin = null;
    document.addEventListener('mousedown', (e) => { const win = e.target.closest('.window'); if (!win) return; const titleBar = e.target.closest('.title-bar'); if (!titleBar || e.target.classList.contains('window-control')) return; draggingWin = win; win.dataset.dragging = '1'; });
    document.addEventListener('mouseup', () => { if (!draggingWin) return; const win = draggingWin; delete draggingWin.dataset.dragging; const rect = win.getBoundingClientRect(); const W = window.innerWidth; const H = window.innerHeight - (parseInt(getComputedStyle(document.documentElement).getPropertyValue('--taskbar-height')) || 48); if (draggingWin) { draggingWin = null; function near(val, edge) { return Math.abs(val - edge) <= SNAP_THRESHOLD; } let snap = null; if (near(rect.top, 0) && rect.left > SNAP_THRESHOLD && rect.right < W - SNAP_THRESHOLD) { snap = {left: 0, top: 0, width: W, height: H}; } if (!snap) { if (near(rect.left, 0)) snap = {left:0, top:0, width: W/2, height:H}; else if (near(rect.right, W)) snap = {left:W/2, top:0, width: W/2, height:H}; } if (!snap) { if (near(rect.top, 0)) snap = {left:0, top:0, width:W, height:H/2}; else if (near(rect.bottom, H)) snap = {left:0, top:H/2, width:W, height:H/2}; } if (!snap) { if (near(rect.left,0) && near(rect.top,0)) snap = {left:0, top:0, width:W/2, height:H/2}; else if (near(rect.right,W) && near(rect.top,0)) snap = {left:W/2, top:0, width:W/2, height:H/2}; else if (near(rect.left,0) && near(rect.bottom,H)) snap = {left:0, top:H/2, width:W/2, height:H/2}; else if (near(rect.right,W) && near(rect.bottom,H))snap = {left:W/2, top:H/2, width:W/2, height:H/2}; } if (snap) { win.style.transition = SNAP_ANIM; Object.assign(win.style, { left: snap.left + 'px', top: snap.top + 'px', width: snap.width + 'px', height: snap.height + 'px' }); setTimeout(() => (win.style.transition = ''), 200); } } });
})();